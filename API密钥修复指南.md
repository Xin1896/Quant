# OKX API密钥修复指南

## 问题诊断结果

根据诊断脚本的结果，你的API密钥出现了以下问题：
- **错误代码**: 50119
- **错误信息**: "API key doesn't exist"
- **状态**: API密钥不存在或已被删除

## 解决方案

### 1. 检查API密钥状态

登录OKX账户，按以下步骤检查：

1. **访问API管理页面**
   - 登录 [OKX官网](https://www.okx.com)
   - 点击右上角头像 → "设置"
   - 选择 "API管理"

2. **检查API密钥列表**
   - 查看你的API密钥是否在列表中
   - 检查状态是否为"启用"
   - 确认API密钥未过期

### 2. 重新创建API密钥

如果API密钥不存在或已失效，请重新创建：

1. **删除旧密钥**（如果存在）
   - 在API管理页面找到旧密钥
   - 点击"删除"按钮

2. **创建新API密钥**
   - 点击"创建API密钥"
   - 设置API密钥名称（如：TradingBot）
   - **重要权限设置**：
     - ✅ 交易
     - ✅ 查询
     - ❌ 提现（建议不勾选，安全考虑）

3. **安全设置**
   - 设置IP白名单（可选，但推荐）
   - 记录API Key、Secret Key和Passphrase

### 3. 更新环境变量

创建或更新 `.env` 文件：

```env
OKX_API_KEY=你的新API密钥
OKX_API_SECRET=你的新Secret密钥
OKX_PASSPHRASE=你的新Passphrase
```

**注意事项**：
- 确保没有多余的空格
- 确保没有引号包围
- 确保文件格式为UTF-8

### 4. 验证新密钥

运行验证脚本：

```bash
python debug_okx_api.py
```

## 常见问题

### Q: API密钥格式要求是什么？
A: 
- API Key: 36位字符
- Secret Key: 32位字符  
- Passphrase: 自定义长度（通常8-20位）

### Q: 为什么需要交易权限？
A: 查看挂单需要访问私有API，必须具有交易权限。

### Q: IP白名单如何设置？
A: 在创建API密钥时，可以设置允许的IP地址。如果不设置，则所有IP都可以访问（不推荐）。

### Q: API密钥有有效期吗？
A: OKX的API密钥通常没有过期时间，但建议定期更换以提高安全性。

## 安全建议

1. **权限最小化**
   - 只勾选必要的权限
   - 不要勾选提现权限

2. **IP限制**
   - 设置IP白名单
   - 只允许你的服务器IP访问

3. **定期更换**
   - 建议每3-6个月更换一次API密钥
   - 及时删除不使用的密钥

4. **环境变量安全**
   - 不要将.env文件提交到版本控制
   - 确保.env文件权限设置正确

## 测试步骤

1. 重新创建API密钥
2. 更新.env文件
3. 运行诊断脚本：`python debug_okx_api.py`
4. 如果测试通过，运行监控器：`python okx_order_monitor.py`

## 联系支持

如果问题仍然存在，可以：
1. 检查OKX官方文档
2. 联系OKX客服支持
3. 在OKX社区论坛寻求帮助 