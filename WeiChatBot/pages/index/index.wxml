<!--pages/index/index.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-section" wx:if="{{!hasUserInfo}}">
    <button 
      wx:if="{{canIUseGetUserProfile}}" 
      bindtap="getUserProfile" 
      class="user-info-btn"
    >
      è·å–ç”¨æˆ·ä¿¡æ¯
    </button>
    <button 
      wx:else 
      open-type="getUserInfo" 
      bindgetuserinfo="getUserInfo" 
      class="user-info-btn"
    >
      è·å–ç”¨æˆ·ä¿¡æ¯
    </button>
  </view>

  <!-- ä»Šæ—¥é»„å†å¡ç‰‡ -->
  <view class="lunar-card" wx:if="{{todayLunar}}">
    <view class="card-header">
      <text class="card-title">ğŸ“… ä»Šæ—¥é»„å†</text>
      <text class="card-date">{{todayLunar.date.toLocaleDateString()}}</text>
    </view>
    
    <view class="lunar-info">
      <view class="lunar-date">
        <text class="label">å†œå†ï¼š</text>
        <text class="value">{{todayLunar.lunarDate}}</text>
      </view>
      
      <view class="zodiac-info">
        <text class="label">ç”Ÿè‚–ï¼š</text>
        <text class="value">{{todayLunar.zodiac}}</text>
        <text class="label">æ˜Ÿåº§ï¼š</text>
        <text class="value">{{todayLunar.constellation}}</text>
      </view>
      
      <view class="activities">
        <view class="suitable">
          <text class="label">å®œï¼š</text>
          <text class="value">{{todayLunar.suitable.join('ã€')}}</text>
        </view>
        <view class="unsuitable">
          <text class="label">å¿Œï¼š</text>
          <text class="value">{{todayLunar.unsuitable.join('ã€')}}</text>
        </view>
      </view>
      
      <view class="description">
        <text>{{todayLunar.description}}</text>
      </view>
      
      <view class="festivals" wx:if="{{todayLunar.festivals.length > 0}}">
        <text class="label">èŠ‚æ—¥ï¼š</text>
        <text class="value">{{todayLunar.festivals.join('ã€')}}</text>
      </view>
    </view>
    
    <view class="card-actions">
      <button class="action-btn" bindtap="shareLunar">åˆ†äº«</button>
      <button class="action-btn" bindtap="goToCalendar">æŸ¥çœ‹è¯¦æƒ…</button>
    </view>
  </view>

  <!-- ä»Šæ—¥ç”Ÿæ—¥å¡ç‰‡ -->
  <view class="birthday-card" wx:if="{{todayBirthdays.length > 0}}">
    <view class="card-header">
      <text class="card-title">ğŸ‰ ä»Šæ—¥ç”Ÿæ—¥</text>
      <text class="birthday-count">{{todayBirthdays.length}}äºº</text>
    </view>
    
    <view class="birthday-list">
      <view 
        class="birthday-item" 
        wx:for="{{todayBirthdays}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="viewBirthday"
      >
        <view class="birthday-info">
          <text class="birthday-name">{{item.name}}</text>
          <text class="birthday-date">å†œå†{{item.lunarMonth}}æœˆ{{item.lunarDay}}æ—¥</text>
        </view>
        <button 
          class="wish-btn" 
          data-id="{{item.id}}" 
          bindtap="sendBirthdayWish"
          catchtap="true"
        >
          å‘é€ç¥ç¦
        </button>
      </view>
    </view>
  </view>

  <!-- å³å°†åˆ°æ¥çš„ç”Ÿæ—¥ -->
  <view class="upcoming-card" wx:if="{{upcomingBirthdays.length > 0}}">
    <view class="card-header">
      <text class="card-title">ğŸ“… å³å°†åˆ°æ¥</text>
      <text class="upcoming-count">æœªæ¥7å¤©</text>
    </view>
    
    <view class="upcoming-list">
      <view 
        class="upcoming-item" 
        wx:for="{{upcomingBirthdays}}" 
        wx:key="date"
      >
        <view class="upcoming-date">
          <text class="date">{{item.date.toLocaleDateString()}}</text>
          <text class="lunar-date">{{item.lunarDate}}</text>
        </view>
        <view class="upcoming-birthdays">
          <text 
            class="birthday-name" 
            wx:for="{{item.birthdays}}" 
            wx:key="id" 
            wx:for-item="birthday"
          >
            {{birthday.name}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <button class="quick-btn primary" bindtap="addBirthday">
      <text class="btn-icon">â•</text>
      <text class="btn-text">æ·»åŠ ç”Ÿæ—¥</text>
    </button>
    
    <button class="quick-btn" bindtap="goToBirthday">
      <text class="btn-icon">ğŸ“‹</text>
      <text class="btn-text">ç”Ÿæ—¥ç®¡ç†</text>
    </button>
    
    <button class="quick-btn" bindtap="goToCalendar">
      <text class="btn-icon">ğŸ“…</text>
      <text class="btn-text">é»„å†è¯¦æƒ…</text>
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && todayBirthdays.length === 0 && upcomingBirthdays.length === 0}}">
    <text class="empty-icon">ğŸ‚</text>
    <text class="empty-text">è¿˜æ²¡æœ‰ç”Ÿæ—¥è®°å½•</text>
    <button class="empty-btn" bindtap="addBirthday">æ·»åŠ ç¬¬ä¸€ä¸ªç”Ÿæ—¥</button>
  </view>
</view> 